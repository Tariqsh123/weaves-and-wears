<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { background: #f8f9fa; }
h2 { margin-bottom: 30px; }
.product-img { width: 60px; height: 60px; object-fit: cover; }
.card { box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
</style>
</head>
<body>

<div class="container py-5">
  <h2 class="text-center">Product Management Dashboard</h2>

  <!-- Add Product Form -->
  <div class="card p-4 mb-4">
    <h5 class="mb-3">Add New Product</h5>
    <form id="productForm">
      <div class="mb-3">
        <label class="form-label">Product Name</label>
        <input type="text" id="productName" class="form-control" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Price (PKR)</label>
        <input type="number" id="productPrice" class="form-control" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Image URL</label>
        <input type="text" id="productImage" class="form-control" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Description</label>
        <textarea id="productDesc" class="form-control" rows="3" required></textarea>
      </div>
      <button type="submit" class="btn btn-primary" style="background-color:#16c9bd; border:none;">Add Product</button>
      <button type="button" class="btn btn-secondary" id="downloadJson">Download JSON</button>
    </form>
  </div>

  <!-- Product List -->
  <div class="card p-4">
    <h5 class="mb-3">Existing Products</h5>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Name</th>
          <th>Price</th>
          <th>Image</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="productTableBody"></tbody>
    </table>
  </div>
</div>

<script>
let products = [];

// Fetch existing products from products.json
fetch('products.json')
  .then(res => res.json())
  .then(data => {
    products = data;

    // Merge with any products saved in localStorage
    const savedProducts = localStorage.getItem('products');
    if(savedProducts){
      const localProducts = JSON.parse(savedProducts);
      products = [...products, ...localProducts];
    }

    renderProducts();
  })
  .catch(err => {
    console.error('Failed to load products.json', err);
    // Fallback: load only localStorage products
    const savedProducts = localStorage.getItem('products');
    if(savedProducts){
      products = JSON.parse(savedProducts);
      renderProducts();
    }
  });

// Render products in table
function renderProducts(){
  const tbody = document.getElementById('productTableBody');
  tbody.innerHTML = '';
  products.forEach((product, index) => {
    tbody.innerHTML += `
      <tr>
        <td>${product.name}</td>
        <td>PKR ${product.price}</td>
        <td><img src="${product.image}" class="product-img rounded"></td>
        <td><button class="btn btn-danger btn-sm" onclick="deleteProduct(${index})">Delete</button></td>
      </tr>
    `;
  });
}

// Add new product
document.getElementById('productForm').addEventListener('submit', function(e){
  e.preventDefault();
  const newProduct = {
    name: document.getElementById('productName').value,
    price: document.getElementById('productPrice').value,
    image: document.getElementById('productImage').value,
    desc: document.getElementById('productDesc').value
  };
  products.push(newProduct);
  localStorage.setItem('products', JSON.stringify(products));
  renderProducts();
  this.reset();
});

// Delete product
function deleteProduct(index){
  if(confirm('Are you sure you want to delete this product?')){
    products.splice(index, 1);
    localStorage.setItem('products', JSON.stringify(products));
    renderProducts();
  }
}

// Download all products (existing + new) as JSON
document.getElementById('downloadJson').addEventListener('click', function(){
  const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(products, null, 2));
  const a = document.createElement('a');
  a.setAttribute("href", dataStr);
  a.setAttribute("download", "products.json");
  document.body.appendChild(a);
  a.click();
  a.remove();
  alert("Download complete! All products (old + new) included.");
});
</script>

</body>
</html>
